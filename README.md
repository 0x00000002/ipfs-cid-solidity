# Create IPFS CID v0 and v1 in Solidity

## Installation

1. Foundry should be installed. https://book.getfoundry.sh/getting-started/installation

2. Install dependencies

```sh
foundryup
forge install OpenZeppelin/openzeppelin-contracts
forge install foundry-rs/forge-std
```

## CIDv0

CIDv0 looks like `QmX9qyMvfYRfho16oYNDZbwHyrGRJPgZWxHX2PcqMkbs9M`.

Base58 encoding was implemented by [@storyicon](https://github.com/storyicon/base58-solidity), and used here as a library when creating CIDv0.

#### Implementation:

```solidity
    /**
     * @notice cidv0 is used to convert sha256 hash to cid(v0) used by IPFS.
     * @param sha256Hash_ sha256 hash generated by anything.
     * @return IPFS cid that meets the TokenData0 specification.
     */
    function cidv0(bytes32 sha256Hash_) public pure returns (string memory) {
        bytes memory hashString = new bytes(34);
        hashString[0] = 0x12;
        hashString[1] = 0x20;
        uint256 hashLength = sha256Hash_.length;
        for (uint256 i = 0; i < hashLength; ++i) {
            hashString[i + 2] = sha256Hash_[i];
        }
        return Base58.encodeToString(hashString);
    }
```

Usage:

```solidity
contract NFT {
   ...
   mapping(uint256 tokenId => string) private _tokenURIs;
   ...
   function setTokenURI_CIDv0(uint256 tokenId, bytes32 sha256Hash) external {
      _tokenURIs[tokenId] =
         string(abi.encodePacked(IPFS_URI, cidv0(sha256Hash)));
   }
}
```

See also tests in [NFT.t.sol](./tests/NFT.t.sol)

## CIDv1

CIDv1 looks like `bafkreidon73zkcrwdb5iafqtijxildoonbwnpv7dyd6ef3qdgads2jc4sy` and uses Base32 encoding.

The AI-drafted [Base32 encoder](Base32Encoding.md) implementation was used to create CIDv1.

#### Implementation

TBD
